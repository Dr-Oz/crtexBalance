# Микросервис для работы с балансом пользователей

## Механизмы реализации отказоустойчивости сервиса
- Использование транзакций при взаимодейтсвии с базой данных для гарантии целостности данных в случае ошибок.
- Журналирование ошибок и операций
- Логирование
- Распределение системы. Разделение бизнес-логики, логики хэндлеров и логики работы с базой данных.
- Контейнеризация
- Внедрен RabbitMQ (Пока только для функции пополнения баланса)

## Что еще можно сделать, для предотвращения потери ордеров
- Внедрить RabbitMQ для остальных функций
- Cистему мониторинга для отслеживания состояния сервиса и базы данных
- Использовать Kuber
- Рекомендуется написать тесты

## Установка
- Склонируйте репозиторий с помощью команды: _```git clone https://github.com/Dr-Oz/crtexBalance.git```_
- Перейдите в папку _crtexBalance_
- Запустите микросервис с помощью Docker Compose: ```docker-compose -f deploy/docker-compose.yml up -d```
***

## Параметры
- Для указания пути до файла конфигурации используйте флаг -config с указанием пути к файлу (по умолчанию используется ./configs/config.yaml).
- Для выполнения миграции базы данных используйте флаг -migrationup
- Для отката миграции базы данных используйте флаг -migrationdown

Пример использования:
```
./crtexBalance -config ./configs/newconfig.yaml -migrationdown -migrationup
```
***

## Чтобы взаимодействовать с микросервисом, используйте следующие функции:
### 1. Пополнение баланса пользователя
Отправьте POST запрос на ```localhost:8081/topup```  с JSON-данными вида:
```json
{
    "userid":15,
    "amount":500,
    "date":"2022-08-01"
}
```
### 2. Получение баланса пользователя
Отправьте POST запрос на ```localhost:8081/```  с JSON-данными вида:
```json
{
    "userid":15
}
```
При успешном выполнении запроса в ответ получаем JSON:
```json
{
    "userid": 15,
    "balance": 500
}
```
### 3. Перевод средств от пользователя пользователю
Отправьте POST запрос на  ```localhost:8081/transfer``` отправляем JSON следующего вида:
```json
{
    "fromuserid":1,
    "touserid":2,
    "amount":100,
    "date":"2022-10-10"
}
```
При успешном выполнении запроса в ответ получаем JSON:
```json
{
    "message": "перевод стредств выполнен"
}
```
***

## Swagger-документация
По адресу ``http://localhost:8081/swagger/index.html`` доступна swagger-документация
